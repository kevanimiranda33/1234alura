document.addEventListener('DOMContentLoaded', () => {
    const taskForm = document.getElementById('task-form');
    const taskInput = document.getElementById('task-input');
    const taskList = document.getElementById('task-list');

    // Função para buscar e exibir as tarefas
    async function fetchTasks() {
        const response = await fetch('/tasks');
        const tasks = await response.json();
        taskList.innerHTML = ''; // Limpa a lista antes de preencher
        tasks.forEach(task => addTaskToDOM(task));
    }

    // Função para adicionar uma nova tarefa no DOM
    function addTaskToDOM(task) {
        const li = document.createElement('li');
        li.classList.add('task-item');
        li.dataset.id = task.id;
        li.innerHTML = `
            <span>${task.text}</span>
            <button class="delete-btn">Remover</button>
        `;
        taskList.appendChild(li);
    }

    // Adiciona uma nova tarefa ao enviar o formulário
    taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const taskText = taskInput.value.trim();
        if (taskText === '') return;

        const response = await fetch('/tasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ text: taskText })
        });

        if (response.ok) {
            const newTask = await response.json();
            addTaskToDOM(newTask);
            taskInput.value = ''; // Limpa o input
        }
    });

    // Remove uma tarefa ao clicar no botão "Remover"
    taskList.addEventListener('click', async (e) => {
        if (e.target.classList.contains('delete-btn')) {
            const taskItem = e.target.closest('.task-item');
            const taskId = taskItem.dataset.id;

            const response = await fetch(`/tasks/${taskId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                taskItem.remove();
            }
        }
    });

    // Carrega as tarefas quando a página é carregada
    fetchTasks();
});